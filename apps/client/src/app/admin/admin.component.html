<div class='admin-container'>
  <div class='heading-container'>
    <h2 class='section-heading'>Administration</h2>
  </div>

  <div class="alert" *ngIf="message" [class.alert-info]="!messageIsError" [class.alert-danger]="messageIsError">{{message}}</div>

  <div class='admin-users-container'>
    <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
      <li [ngbNavItem]="1">
        <button ngbNavLink>Users</button>
        <ng-template ngbNavContent>
          <table class="table table-striped">
            <thead>
            <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let user of users">
              <td>{{user.firstName}}</td>
              <td>{{user.lastName}}</td>
              <td>{{user.email}}</td>
              <td>
                <div class="pull-right">
                  <button type="button" class="btn btn-dark" title="Edit this user's contact details" (click)="editUser(user)">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button type="button" class="btn btn-dark" title="Remove this user's contact information and their subscriptions" (click)="deleteUser(user)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>
        </ng-template>
      </li>
      <li [ngbNavItem]="2">
        <button ngbNavLink>Upload</button>
        <ng-template ngbNavContent>

          <div class="alert alert-info">
            <p>
              Uploading new artifacts will send out a notification, containing the text 
              entered below in the “Message” field, to subscribers.
            </p>
            <p>
              The file uploaded here needs to be an XML file. It is meant to 
              contain an eRSD Version 1 FHIR bundle. This file gets 
              posted to a FHIR server and can be retrieved by users 
              at the “Old endpoint” for “Version 1 - Specification Bundle” (documented in the 
              <a class="alert-link" href="#/api-keys">Polling Management page</a>).
            </p>
            </div>

          <div class="form-group">
            <label>Bundle XML File</label>
            <input type="file" class="form-control" (change)="handleBundleFileInput($any($event).target.files)" #bundleUploadFile [class.is-invalid]="!bundleFile" accept="application/json, application/xml" />
          </div>

          <div class="form-group">
            <label for="uploadMessage">Message</label>
            <textarea id="uploadMessage" class="form-control" rows="6" [(ngModel)]="bundleUploadMessage" [class.is-invalid]="!bundleUploadMessage"></textarea>
          </div>

          <button id="uploadBundleBtn" type="button" class="btn btn-primary" (click)="uploadBundle()" [disabled]="!bundleFile">
            <span *ngIf="!uploading">Upload</span>
            <span *ngIf="uploading">
              <span class="spinner-border spinner-border-sm mr-3" role="status" aria-hidden="true"></span>
              <span>Uploading...</span>
            </span>
          </button>

          <!-- <button type="button" class="btn btn-primary" (click)="uploadBundle()" [disabled]="!bundleFile || !bundleUploadMessage">Upload</button> -->
        </ng-template>
      </li>
      <li [ngbNavItem]="3">
        <button ngbNavLink>Messages</button>
        <ng-template ngbNavContent>
          <div class="alert alert-info">This will send an email message directly to each of the user's contact email address (which may be different than the email address the user uses for subscriptions).</div>

          <div class="form-group">
            <label for="subject">Subject</label>
            <input id="subject" type="text" class="form-control" [(ngModel)]="emailRequest.subject" [class.is-invalid]="!emailRequest.subject" />
          </div>

          <div class="form-group">
            <label for="emailMessage">Message to be sent</label>
            <textarea id="emailMessage" class="form-control" rows="6" [(ngModel)]="emailRequest.message" [class.is-invalid]="!emailRequest.message"></textarea>
          </div>

          <button type="button" class="btn btn-primary" [disabled]="!emailRequest.subject || !emailRequest.message" (click)="sendEmail()">Send</button>
          <button type="button" class="btn btn-primary attachment-button" (click)="removeEmailAttachments()">Remove attachments from all emails</button>
        </ng-template>
      </li>
      <li [ngbNavItem]="4">
        <button ngbNavLink>RCTC Files</button>
        <ng-template ngbNavContent>
          <div class="alert alert-info">
            <p>
              Upload a Zip file containing the 'RCTC_Release.xlsx' and 'RCTC_Change_Log.xlsx' 
              spreadsheets. This Zip file will then be available to users via the 'Latest RCTC 
              Spreadsheet and Change Log' button on the <a class="alert-link" href="/"> Home page.</a>
            </p>
          
          </div>

          <div class="form-group">
            <label>Zip File with 'RCTC_Release.xlsx' and 'RCTC_Change_Log.xlsx' Spreadsheets</label>
            <input type="file" class="form-control" (change)="handleExcelFileInput($any($event).target.files)" #excelUploadFile [class.is-invalid]="!excelFile" accept=".zip" />
            <!-- <input type="file" class="form-control" (change)="handleExcelFileInput($any($event).target.files)" #excelUploadFile [class.is-invalid]="!excelFile" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" /> -->
          </div>

          <button id="uploadExcelBtn" type="button" class="btn btn-primary" (click)="uploadExcel()" [disabled]="!excelFile">
            <span *ngIf="!uploading">Upload</span>
            <span *ngIf="uploading">
              <span class="spinner-border spinner-border-sm mr-3" role="status" aria-hidden="true"></span>
              <span>Uploading...</span>
            </span>
          </button>

          <!-- <button type="button" class="btn btn-primary" (click)="uploadExcel()" [disabled]="!excelFile">Upload</button> -->
        </ng-template>
      </li>
    </ul>
    <div [ngbNavOutlet]="nav"></div>
  </div>
</div>
