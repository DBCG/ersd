<h2>Subscription Management</h2>

<div class="alert" [class.alert-info]="!messageIsError" [class.alert-danger]="messageIsError" *ngIf="message">{{message}}</div>

<div class="row">
  <div class="col-md-4">
    <div class="card" *ngIf="userSubscriptions.emailSubscription">
      <div class="card-header">
        Email subscription
      </div>
      <div class="card-body">
        <div class="form-group">
          <label>Email Address</label>
          <input type="text" class="form-control" placeholder="joe@somewhere.com"
                 [(ngModel)]="userSubscriptions.emailSubscription.emailAddress"
                 [class.is-invalid]="emailAddress.errors?.email || emailAddress.errors?.required"
                 email="true"
                 required="required"
                 #emailAddress="ngModel" />
        </div>

        <div class="form-group">
          <input type="checkbox" [(ngModel)]="userSubscriptions.emailSubscription.includeArtifacts" /> Include changed artifacts
        </div>

        <div class="form-group" *ngIf="userSubscriptions.emailSubscription.includeArtifacts || userSubscriptions.emailSubscription.format">
          <select class="form-control" [(ngModel)]="userSubscriptions.emailSubscription.format">
            <option value="json">JSON</option>
            <option value="xml">XML</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <input type="checkbox" [ngModel]="!!userSubscriptions.restSubscription" (ngModelChange)="toggleRest($event)" /> REST hook subscription
      </div>
      <div class="card-body" *ngIf="userSubscriptions.restSubscription">
        <div class="form-group">
          <label>REST Endpoint</label>
          <input type="text" class="form-control"
                 [(ngModel)]="userSubscriptions.restSubscription.endpoint"
                 [class.is-invalid]="restEndpoint.errors?.pattern || restEndpoint.errors?.required"
                 required="required"
                 pattern="^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})$"
                 #restEndpoint="ngModel" />
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <input type="checkbox" [ngModel]="!!userSubscriptions.smsSubscription" (ngModelChange)="toggleSms($event)" /> SMS Subscription
      </div>
      <div class="card-body" *ngIf="userSubscriptions.smsSubscription">
        <div class="form-group">
          <label>Carrier</label>
          <select class="form-control"
                  [(ngModel)]="userSubscriptions.smsSubscription.carrier"
                  [class.is-invalid]="carrier.errors?.required"
                  required="required"
                  #carrier="ngModel">
            <option [ngValue]="undefined">SELECT</option>
            <option>Verizon</option>
            <option>AT&T</option>
            <option>Sprint</option>
            <option>T-Mobile</option>
          </select>
        </div>
        <div class="form-group">
          <label>Mobile Phone</label>
          <input type="text" class="form-control" placeholder="XXX-XXX-XXXX"
                 [(ngModel)]="userSubscriptions.smsSubscription.mobilePhone"
                 [class.is-invalid]="mobile.errors?.required || mobile.errors?.pattern"
                 pattern="^\d{3}-\d{3}-\d{4}$"
                 required="required"
                 #mobile="ngModel" />
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  <button type="button" class="btn btn-primary" [disabled]="!isValid" (click)="save()">Save</button>
</div>
